
import pandas as pd
import re
from pathlib import Path

# Load data
nodes_df = pd.read_csv('c:/social_graphs_project/data/processed/nodes.csv')

# Focus on potential targets (NPCs, Bosses, Locations)
targets = nodes_df[nodes_df['type'].isin(['npc', 'boss', 'location'])]
items = nodes_df[nodes_df['type'].isin(['item', 'weapon', 'armor', 'talisman', 'spell'])]

print("Node Counts by Type:")
print(nodes_df['type'].value_counts())

print(f"\nPotential Targets (NPCs/Bosses/Locs): {len(targets)}")
print(f"Potential Sources (Items/Weapons/etc): {len(items)}")

# Create a better mapping
# 1. Full Name
# 2. First Name (if length > 3 and not common word)
# 3. Title removal (e.g. "Blaidd the Half-Wolf" -> "Blaidd")

target_map = {}
common_words = {"The", "Great", "Black", "Red", "White", "Blue", "Gold", "Star", "Moon", "Sun", "Lord", "Lady", "King", "Queen", "Knight", "Soldier", "Warrior", "Hunter", "Sorcerer", "Witch", "Beast", "Finger", "Hand", "Head", "Foot", "Eye", "Ear", "Nose", "Mouth", "Arm", "Leg", "Body", "Blood", "Rot", "Poison", "Fire", "Ice", "Lightning", "Magic", "Holy", "Dark", "Light", "Shadow", "Spirit", "Soul", "God", "Demi-God", "Elden", "Ring", "Tree", "Erdtree", "Land", "Lands", "Between", "World", "Universe", "Cosmos", "Star", "Moon", "Sun", "Sky", "Sea", "Ocean", "River", "Lake", "Mountain", "Valley", "Hill", "Forest", "Wood", "Jungle", "Desert", "Plain", "Field", "Meadow", "Garden", "Park", "City", "Town", "Village", "Hamlet", "Castle", "Fort", "Tower", "Dungeon", "Cave", "Mine", "Grave", "Tomb", "Catacomb", "Ruins", "Temple", "Shrine", "Church", "Cathedral", "Chapel", "Monastery", "Abbey", "Priory", "Convent", "Sanctuary", "Altar", "Throne", "Room", "Chamber", "Hall", "Corridor", "Passage", "Way", "Path", "Road", "Street", "Lane", "Alley", "Bridge", "Gate", "Door", "Window", "Wall", "Floor", "Ceiling", "Roof", "Stairs", "Ladder", "Elevator", "Lift", "Platform", "Stage", "Arena", "Stadium", "Theater", "Cinema", "Museum", "Library", "School", "University", "College", "Institute", "Academy", "Hospital", "Clinic", "Pharmacy", "Shop", "Store", "Market", "Bazaar", "Mall", "Bank", "Post", "Office", "Station", "Stop", "Terminal", "Port", "Harbor", "Dock", "Pier", "Wharf", "Airport", "Helipad", "Spaceport", "Launchpad", "Base", "Camp", "Outpost", "Fortress", "Citadel", "Stronghold", "Keep", "Bastion", "Bulwark", "Rampart", "Parapet", "Battlement", "Turret", "Spire", "Steeple", "Dome", "Cupola", "Minaret", "Obelisk", "Column", "Pillar", "Post", "Pole", "Mast", "Flagpole", "Totem", "Monument", "Statue", "Sculpture", "Fountain", "Well", "Spring", "Geyser", "Volcano", "Crater", "Canyon", "Gorge", "Ravine", "Chasm", "Abyss", "Void", "Rift", "Fissure", "Crack", "Crevice", "Gap", "Hole", "Pit", "Shaft", "Tunnel", "Tube", "Pipe", "Duct", "Vent", "Drain", "Sewer", "Gutter", "Trench", "Ditch", "Moat", "Canal", "Channel", "Strait", "Sound", "Bay", "Gulf", "Inlet", "Cove", "Lagoon", "Estuary", "Delta", "Marsh", "Swamp", "Bog", "Fen", "Mire", "Slough", "Wetland", "Glacier", "Iceberg", "Icefield", "Icecap", "Snowfield", "Snowpack", "Snowdrift", "Avalanche", "Landslide", "Mudslide", "Rockfall", "Earthquake", "Tsunami", "Flood", "Drought", "Famine", "Plague", "Epidemic", "Pandemic", "War", "Battle", "Fight", "Conflict", "Struggle", "Clash", "Skirmish", "Duel", "Brawl", "Riot", "Rebellion", "Revolution", "Uprising", "Insurrection", "Mutiny", "Coup", "Conspiracy", "Plot", "Scheme", "Plan", "Strategy", "Tactic", "Maneuver", "Operation", "Mission", "Quest", "Journey", "Voyage", "Expedition", "Adventure", "Exploration", "Discovery", "Invention", "Innovation", "Creation", "Destruction", "Devastation", "Ruin", "Collapse", "Fall", "Decline", "Decay", "Rot", "Corruption", "Pollution", "Contamination", "Infection", "Disease", "Sickness", "Illness", "Ailment", "Malady", "Disorder", "Syndrome", "Condition", "State", "Status", "Situation", "Circumstance", "Event", "Incident", "Occurrence", "Happening", "Phenomenon", "Miracle", "Wonder", "Marvel", "Spectacle", "Sight", "View", "Scene", "Panorama", "Vista", "Landscape", "Seascape", "Cityscape", "Skyline", "Horizon", "Background", "Foreground", "Middleground", "Perspective", "Aspect", "Angle", "Viewpoint", "Standpoint", "Outlook", "Attitude", "Opinion", "Belief", "Faith", "Religion", "Cult", "Sect", "Denomination", "Church", "Temple", "Shrine", "Mosque", "Synagogue", "Gurdwara", "Pagoda", "Stupa", "Mandir", "Ashram", "Monastery", "Convent", "Abbey", "Priory", "Hermitage", "Retreat", "Sanctuary", "Refuge", "Shelter", "Haven", "Harbor", "Port", "Anchorage", "Mooring", "Berth", "Slip", "Dock", "Pier", "Jetty", "Wharf", "Quay", "Levee", "Dike", "Dam", "Weir", "Lock", "Sluice", "Gate", "Valve", "Tap", "Faucet", "Spigot", "Nozzle", "Spout", "Jet", "Spray", "Mist", "Fog", "Haze", "Smog", "Smoke", "Fume", "Gas", "Vapor", "Steam", "Cloud", "Rain", "Snow", "Hail", "Sleet", "Ice", "Frost", "Dew", "Wind", "Breeze", "Gale", "Storm", "Tempest", "Hurricane", "Typhoon", "Cyclone", "Tornado", "Twister", "Whirlwind", "Dust", "Sand", "Dirt", "Mud", "Clay", "Silt", "Loam", "Gravel", "Pebble", "Rock", "Stone", "Boulder", "Ore", "Mineral", "Gem", "Jewel", "Crystal", "Diamond", "Ruby", "Sapphire", "Emerald", "Topaz", "Amethyst", "Quartz", "Jade", "Pearl", "Coral", "Amber", "Ivory", "Bone", "Horn", "Tooth", "Claw", "Nail", "Hoof", "Scale", "Feather", "Fur", "Hair", "Wool", "Silk", "Cotton", "Linen", "Hemp", "Jute", "Leather", "Hide", "Skin", "Flesh", "Muscle", "Fat", "Blood", "Sweat", "Tears", "Saliva", "Urine", "Feces", "Manure", "Guano", "Compost", "Fertilizer", "Pesticide", "Herbicide", "Fungicide", "Insecticide", "Poison", "Toxin", "Venom", "Antidote", "Cure", "Remedy", "Medicine", "Drug", "Potion", "Elixir", "Tonic", "Balm", "Salve", "Ointment", "Cream", "Lotion", "Gel", "Paste", "Powder", "Dust", "Spray", "Mist", "Gas", "Liquid", "Solid", "Plasma", "Energy", "Power", "Force", "Strength", "Might", "Vigor", "Vitality", "Life", "Death", "Birth", "Growth", "Aging", "Decay", "Rot", "Decomposition", "Dissolution", "Disintegration", "Fragmentation", "Shattering", "Breaking", "Cracking", "Splitting", "Tearing", "Ripping", "Cutting", "Slicing", "Chopping", "Hacking", "Slashing", "Stabbing", "Piercing", "Puncturing", "Drilling", "Boring", "Digging", "Excavating", "Mining", "Quarrying", "Harvesting", "Gathering", "Collecting", "Accumulating", "Amassing", "Hoarding", "Saving", "Investing", "Spending", "Wasting", "Squandering", "Losing", "Finding", "Discovering", "Inventing", "Creating", "Making", "Building", "Constructing", "Assembling", "Fabricating", "Manufacturing", "Producing", "Generating", "Forming", "Shaping", "Molding", "Casting", "Forging", "Welding", "Soldering", "Brazing", "Gluing", "Bonding", "Fusing", "Melting", "Freezing", "Boiling", "Evaporating", "Condensing", "Sublimating", "Deposition", "Precipitation", "Crystallization", "Solidification", "Liquefaction", "Gasification", "Ionization", "Recombination", "Neutralization", "Oxidation", "Reduction", "Combustion", "Explosion", "Detonation", "Deflagration", "Implosion", "Collapse", "Expansion", "Contraction", "Inflation", "Deflation", "Acceleration", "Deceleration", "Velocity", "Speed", "Pace", "Tempo", "Rhythm", "Beat", "Pulse", "Cycle", "Period", "Frequency", "Wavelength", "Amplitude", "Phase", "Shift", "Drift", "Flow", "Current", "Stream", "Tide", "Wave", "Ripple", "Surge", "Swell", "Flood", "Ebb", "Flux", "Change", "Transformation", "Metamorphosis", "Evolution", "Development", "Progress", "Regress", "Advance", "Retreat", "Rise", "Fall", "Ascent", "Descent", "Climb", "Drop", "Jump", "Leap", "Hop", "Skip", "Run", "Walk", "Jog", "Sprint", "Dash", "Rush", "Hurry", "Race", "Chase", "Pursuit", "Hunt", "Search", "Quest", "Inquiry", "Investigation", "Examination", "Inspection", "Analysis", "Study", "Research", "Survey", "Review", "Audit", "Assessment", "Evaluation", "Appraisal", "Estimation", "Calculation", "Computation", "Measurement", "Observation", "Perception", "Sensation", "Feeling", "Emotion", "Passion", "Desire", "Wish", "Hope", "Dream", "Fantasy", "Imagination", "Thought", "Idea", "Concept", "Notion", "Theory", "Hypothesis", "Assumption", "Premise", "Conclusion", "Inference", "Deduction", "Induction", "Logic", "Reason", "Rationale", "Justification", "Explanation", "Description", "Definition", "Meaning", "Sense", "Significance", "Importance", "Value", "Worth", "Merit", "Quality", "Attribute", "Property", "Characteristic", "Feature", "Trait", "Aspect", "Element", "Component", "Part", "Piece", "Fragment", "Segment", "Section", "Portion", "Share", "Slice", "Chunk", "Block", "Lump", "Clump", "Cluster", "Group", "Set", "Collection", "Batch", "Lot", "Bundle", "Pack", "Package", "Parcel", "Packet", "Bag", "Sack", "Box", "Case", "Crate", "Chest", "Trunk", "Bin", "Basket", "Bucket", "Pail", "Can", "Tin", "Jar", "Bottle", "Flask", "Vial", "Tube", "Pipe", "Hose", "Wire", "Cable", "Cord", "Rope", "String", "Thread", "Yarn", "Line", "Chain", "Link", "Connection", "Relation", "Relationship", "Association", "Bond", "Tie", "Knot", "Loop", "Coil", "Spiral", "Helix", "Curve", "Arc", "Circle", "Ring", "Disc", "Sphere", "Globe", "Ball", "Orb", "Cube", "Block", "Brick", "Tile", "Plate", "Sheet", "Slab", "Bar", "Rod", "Stick", "Pole", "Post", "Stake", "Spike", "Nail", "Screw", "Bolt", "Nut", "Washer", "Pin", "Needle", "Hook", "Clasp", "Clip", "Clamp", "Vise", "Grip", "Handle", "Knob", "Lever", "Switch", "Button", "Key", "Lock", "Latch", "Hinge", "Joint", "Seam", "Weld", "Glue", "Cement", "Mortar", "Plaster", "Paint", "Varnish", "Lacquer", "Enamel", "Glaze", "Coating", "Layer", "Film", "Skin", "Shell", "Crust", "Bark", "Rind", "Peel", "Husk", "Pod", "Seed", "Nut", "Kernel", "Grain", "Berry", "Fruit", "Vegetable", "Plant", "Tree", "Bush", "Shrub", "Herb", "Grass", "Weed", "Flower", "Blossom", "Bloom", "Petal", "Leaf", "Stem", "Stalk", "Root", "Trunk", "Branch", "Twig", "Limb", "Bough", "Log", "Wood", "Timber", "Lumber", "Plank", "Board", "Panel", "Veneer", "Plywood", "Fiberboard", "Particleboard", "Hardboard", "MDF", "OSB", "Chipboard", "Cardboard", "Paper", "Parchment", "Vellum", "Canvas", "Fabric", "Cloth", "Textile", "Material", "Substance", "Matter", "Stuff", "Thing", "Object", "Item", "Article", "Entity", "Being", "Creature", "Organism", "Animal", "Beast", "Monster", "Demon", "Devil", "Spirit", "Ghost", "Phantom", "Specter", "Wraith", "Shade", "Shadow", "Soul", "Mind", "Consciousness", "Awareness", "Perception", "Cognition", "Intelligence", "Wisdom", "Knowledge", "Understanding", "Insight", "Intuition", "Instinct", "Reason", "Logic", "Thought", "Idea", "Concept", "Notion", "Belief", "Faith", "Hope", "Charity", "Love", "Hate", "Anger", "Fear", "Joy", "Sadness", "Grief", "Sorrow", "Pain", "Pleasure", "Delight", "Ecstasy", "Bliss", "Happiness", "Contentment", "Satisfaction", "Peace", "Calm", "Serenity", "Tranquility", "Silence", "Quiet", "Stillness", "Noise", "Sound", "Music", "Melody", "Harmony", "Rhythm", "Beat", "Tempo", "Tone", "Pitch", "Volume", "Loudness", "Softness", "Hardness", "Roughness", "Smoothness", "Texture", "Surface", "Shape", "Form", "Structure", "Pattern", "Design", "Plan", "Layout", "Arrangement", "Organization", "Order", "Chaos", "Disorder", "Confusion", "Mess", "Clutter", "Jumble", "Tangle", "Knot", "Snarl", "Maze", "Labyrinth", "Puzzle", "Riddle", "Enigma", "Mystery", "Secret", "Code", "Cipher", "Key", "Lock", "Door", "Gate", "Portal", "Entrance", "Exit", "Opening", "Closing", "Beginning", "End", "Start", "Finish", "Origin", "Source", "Cause", "Effect", "Result", "Outcome", "Consequence", "Impact", "Influence", "Power", "Authority", "Control", "Command", "Rule", "Law", "Regulation", "Statute", "Ordinance", "Decree", "Edict", "Proclamation", "Declaration", "Statement", "Announcement", "Notice", "Message", "Signal", "Sign", "Symbol", "Icon", "Logo", "Emblem", "Badge", "Mark", "Brand", "Label", "Tag", "Ticket", "Sticker", "Stamp", "Seal", "Signature", "Autograph", "Name", "Title", "Designation", "Appellation", "Moniker", "Nickname", "Alias", "Pseudonym", "Handle", "Username", "Login", "Password", "Code", "Key", "Token", "Ticket", "Pass", "Permit", "License", "Certificate", "Diploma", "Degree", "Award", "Prize", "Trophy", "Medal", "Ribbon", "Badge", "Star", "Cross", "Crown", "Scepter", "Orb", "Throne", "Altar", "Shrine", "Temple", "Church", "Cathedral", "Basilica", "Chapel", "Mosque", "Synagogue", "Pagoda", "Stupa", "Mandir", "Ashram", "Monastery", "Convent", "Abbey", "Priory", "Hermitage", "Retreat", "Sanctuary", "Refuge", "Shelter", "Haven", "Harbor", "Port", "Dock", "Pier", "Wharf", "Quay", "Marina", "Beach", "Coast", "Shore", "Bank", "Edge", "Rim", "Brim", "Lip", "Margin", "Border", "Boundary", "Limit", "End", "Extremity", "Tip", "Point", "Peak", "Summit", "Top", "Bottom", "Base", "Foundation", "Ground", "Floor", "Earth", "Soil", "Dirt", "Mud", "Sand", "Gravel", "Rock", "Stone", "Pebble", "Boulder", "Cliff", "Bluff", "Precipice", "Ledge", "Shelf", "Ridge", "Range", "Mountain", "Hill", "Mound", "Knoll", "Heap", "Pile", "Stack", "Mass", "Bulk", "Volume", "Quantity", "Amount", "Number", "Count", "Total", "Sum", "Aggregate", "Whole", "Part", "Fraction", "Percentage", "Ratio", "Proportion", "Rate", "Speed", "Velocity", "Acceleration", "Force", "Power", "Energy", "Work", "Heat", "Temperature", "Pressure", "Density", "Viscosity", "Fluidity", "Solubility", "Conductivity", "Resistivity", "Capacitance", "Inductance", "Impedance", "Reactance", "Admittance", "Susceptance", "Conductance", "Voltage", "Current", "Power", "Frequency", "Wavelength", "Period", "Phase", "Amplitude", "Intensity", "Brightness", "Luminosity", "Color", "Hue", "Saturation", "Value", "Lightness", "Darkness", "Contrast", "Sharpness", "Blur", "Focus", "Depth", "Perspective", "View", "Scene", "Image", "Picture", "Photo", "Photograph", "Snapshot", "Shot", "Frame", "Clip", "Video", "Movie", "Film", "Cinema", "Theater", "Play", "Drama", "Comedy", "Tragedy", "Satire", "Parody", "Spoof", "Farce", "Burlesque", "Vaudeville", "Cabaret", "Circus", "Carnival", "Fair", "Festival", "Fete", "Gala", "Party", "Bash", "Blowout", "Shindig", "Hoedown", "Rave", "Disco", "Club", "Bar", "Pub", "Tavern", "Inn", "Hotel", "Motel", "Hostel", "Lodge", "Resort", "Spa", "Camp", "Site", "Ground", "Field", "Park", "Garden", "Yard", "Court", "Plaza", "Square", "Circle", "Oval", "Triangle", "Rectangle", "Polygon", "Shape", "Form", "Figure", "Body", "Object", "Thing", "Entity", "Being", "Creature", "Organism", "Life", "Death", "Existence", "Reality", "Truth", "Fact", "Fiction", "Myth", "Legend", "Fable", "Tale", "Story", "Narrative", "Account", "Report", "Record", "History", "Chronicle", "Annals", "Archive", "Library", "Museum", "Gallery", "Exhibition", "Show", "Display", "Presentation", "Demonstration", "Proof", "Evidence", "Testimony", "Witness", "Judge", "Jury", "Verdict", "Sentence", "Punishment", "Penalty", "Fine", "Fee", "Tax", "Duty", "Tariff", "Toll", "Charge", "Cost", "Price", "Value", "Worth", "Merit", "Quality", "Grade", "Rank", "Level", "Tier", "Class", "Category", "Type", "Kind", "Sort", "Variety", "Species", "Genus", "Family", "Order", "Class", "Phylum", "Kingdom", "Domain", "Life", "Nature", "World", "Universe", "Cosmos", "Space", "Time", "Dimension", "Reality", "Existence", "Being", "Nothingness", "Void", "Empty", "Full", "Whole", "Complete", "Total", "Entire", "All", "Every", "Each", "Any", "Some", "None", "No", "Yes", "Maybe", "Perhaps", "Possibly", "Probably", "Likely", "Unlikely", "Certain", "Sure", "Positive", "Negative", "Good", "Bad", "Right", "Wrong", "True", "False", "Real", "Fake", "Genuine", "Artificial", "Natural", "Synthetic", "Organic", "Inorganic", "Living", "Dead", "Alive", "Deceased", "Gone", "Lost", "Found", "Missing", "Present", "Absent", "Here", "There", "Where", "When", "Why", "How", "Who", "What", "Which", "That", "This", "These", "Those", "It", "He", "She", "They", "We", "You", "I", "Me", "My", "Mine", "Your", "Yours", "His", "Her", "Hers", "Their", "Theirs", "Our", "Ours", "Us", "Them", "Him", "Her", "It", "Self", "Myself", "Yourself", "Himself", "Herself", "Itself", "Ourselves", "Yourselves", "Themselves", "Everyone", "Everybody", "Everything", "Everywhere", "Someone", "Somebody", "Something", "Somewhere", "Anyone", "Anybody", "Anything", "Anywhere", "Noone", "Nobody", "Nothing", "Nowhere"}

for _, row in targets.iterrows():
    name = row['name']
    node_id = row['node_id']
    
    # Add full name
    target_map[name] = node_id
    
    # Add simplified name (e.g. "Malenia, Blade of Miquella" -> "Malenia")
    if "," in name:
        simple_name = name.split(",")[0].strip()
        if len(simple_name) > 3 and simple_name not in common_words:
            target_map[simple_name] = node_id
            
    # Add "The X" removal (e.g. "Blaidd the Half-Wolf" -> "Blaidd")
    # This is tricky, let's just stick to comma splitting for now as it's the most common pattern in ER
    
sorted_names = sorted(target_map.keys(), key=len, reverse=True)
print(f"Total target names (including aliases): {len(sorted_names)}")
print(f"Top 10 names: {sorted_names[:10]}")

# Test matching on a sample
sample_items = items.sample(100)
matches = 0

pattern = re.compile(r'\b(' + '|'.join(map(re.escape, sorted_names)) + r')\b')

for _, row in sample_items.iterrows():
    desc = str(row['description'])
    found = pattern.findall(desc)
    if found:
        matches += 1
        print(f"Match in {row['name']}: {found}")
        
print(f"Found matches in {matches}/100 items.")
